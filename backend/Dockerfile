FROM node:23-alpine

WORKDIR /app

COPY package*.json ./

RUN npm install

RUN mkdir -p logs

COPY newrelic.js ./

COPY . .

ENV NODE_ENV=development
ENV PORT=4000
ENV MONGODB_URI=mongodb://mongodb:27017/spacerover
ENV TELEMETRY_SERVICE_URL=http://telemetry:6000
ENV LOG_LEVEL=debug
ARG NEW_RELIC_LICENSE_KEY
ENV NEW_RELIC_LICENSE_KEY=$NEW_RELIC_LICENSE_KEY
ENV NEW_RELIC_APP_NAME=SpaceRover-FleetCommand
ENV NEW_RELIC_BROWSER_MONITORING_ENABLED=true
ENV NEW_RELIC_DISTRIBUTED_TRACING_ENABLED=true
ENV NEW_RELIC_LOG=stdout
ENV NEW_RELIC_NO_CONFIG_FILE=true
ENV ENABLE_SIMULATED_ISSUES=true

EXPOSE 4000

ENTRYPOINT ["node", "-r", "newrelic", "server.js"]
